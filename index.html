<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelHub Ultimate - å…¨åŠŸèƒ½æœ€ç»ˆä¿®å¤ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        .active-day { background: #4f46e5 !important; color: white !important; transform: scale(1.05); box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }
        .cat-sight { background: #e0f2fe; color: #0369a1; border: 1px solid #bae6fd; }
        .cat-food { background: #ffedd5; color: #9a3412; border: 1px solid #fed7aa; }
        .cat-hotel { background: #f3e8ff; color: #7e22ce; border: 1px solid #e9d5ff; }
        .cat-activity { background: #dcfce7; color: #15803d; border: 1px solid #bbf7d0; }
        #search-results { max-height: 400px; overflow-y: auto; z-index: 2000; border-radius: 12px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2); }
        .search-item:hover { background-color: #f8fafc; cursor: pointer; }
        .dragging { opacity: 0.5; transform: scale(0.95); }
        .drop-zone { border: 2px dashed #4f46e5 !important; background: #eef2ff !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 h-screen flex flex-col overflow-hidden font-sans">

    <header class="h-20 border-b bg-white flex items-center justify-between px-6 shrink-0 z-50 shadow-sm">
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()">
                <div class="w-9 h-9 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold shadow-lg">T</div>
                <h1 class="text-lg font-bold tracking-tighter italic hidden md:block">TravelHub <span class="text-indigo-600">PRO</span></h1>
            </div>
            <input type="date" id="start-date" onchange="updateDates()" class="bg-slate-100 px-3 py-1.5 rounded-lg text-xs font-bold text-indigo-600 outline-none">
        </div>
        
        <div class="flex gap-1.5 overflow-x-auto max-w-[25vw] no-scrollbar" id="day-selector"></div>
        
        <div class="flex gap-2">
            <button onclick="openOverview()" class="bg-slate-900 text-white px-3 py-1.5 rounded-lg text-[10px] font-bold hover:bg-slate-800 transition">ğŸ“Š æ€»è§ˆ</button>
            <button onclick="exportData()" class="bg-amber-500 text-white px-3 py-1.5 rounded-lg text-[10px] font-bold hover:bg-amber-600 transition">ğŸ“¤ å¯¼å‡º</button>
            <button onclick="importData()" class="bg-sky-500 text-white px-3 py-1.5 rounded-lg text-[10px] font-bold hover:bg-sky-600 transition">ğŸ“¥ å¯¼å…¥</button>
            <button onclick="addDay()" class="bg-indigo-600 text-white px-3 py-1.5 rounded-lg text-[10px] font-bold hover:bg-indigo-700 transition">+ å¤©</button>
        </div>
    </header>

    <main class="flex flex-1 overflow-hidden">
        <aside class="w-80 border-r bg-white flex flex-col shrink-0">
            <div class="p-4 border-b relative z-30">
                <input id="map-search" type="text" placeholder="ğŸ” ç²¾å‡†æœç´¢åœ°ç‚¹..." 
                       class="w-full px-4 py-3 bg-slate-100 border-none rounded-xl text-xs focus:ring-2 focus:ring-indigo-500 outline-none">
                <div id="search-results" class="absolute left-4 right-4 mt-2 bg-white border rounded-xl hidden shadow-2xl overflow-hidden custom-scrollbar"></div>
            </div>
            <div id="library-list" class="flex-1 overflow-y-auto p-4 space-y-3 pb-20 no-scrollbar"></div>
        </aside>

        <section class="flex-1 overflow-y-auto p-6 bg-[#f8fafc] relative custom-scrollbar">
            <div class="max-w-3xl mx-auto pb-24">
                <div class="mb-6">
                    <h2 id="current-day-title" class="text-3xl font-black text-slate-800 italic">Day 1</h2>
                    <p id="current-day-date" class="text-indigo-500 text-xs font-bold mt-1 tracking-widest uppercase"></p>
                </div>
                <div class="space-y-6">
                    <div class="slot-container" data-slot="morning">
                        <h3 class="text-[10px] font-black text-slate-300 mb-3 tracking-widest uppercase">â˜€ï¸ ä¸Šåˆ</h3>
                        <div id="slot-morning" class="space-y-3 min-h-[60px] rounded-xl transition-all" ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'morning')"></div>
                    </div>
                    <div class="slot-container" data-slot="noon">
                        <h3 class="text-[10px] font-black text-slate-300 mb-3 tracking-widest uppercase">ğŸ´ ä¸­åˆ</h3>
                        <div id="slot-noon" class="space-y-3 min-h-[60px] rounded-xl transition-all" ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'noon')"></div>
                    </div>
                    <div class="slot-container" data-slot="afternoon">
                        <h3 class="text-[10px] font-black text-slate-300 mb-3 tracking-widest uppercase">ğŸŒ‡ ä¸‹åˆ</h3>
                        <div id="slot-afternoon" class="space-y-3 min-h-[60px] rounded-xl transition-all" ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'afternoon')"></div>
                    </div>
                    <div class="slot-container" data-slot="evening">
                        <h3 class="text-[10px] font-black text-slate-300 mb-3 tracking-widest uppercase">ğŸŒ™ æ™šä¸Š</h3>
                        <div id="slot-evening" class="space-y-3 min-h-[60px] rounded-xl transition-all" ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'evening')"></div>
                    </div>
                </div>
            </div>
        </section>

        <aside class="w-[28rem] border-l bg-white hidden xl:flex flex-col shrink-0 p-6">
            <div id="map" class="h-3/5 rounded-[2rem] shadow-lg border-4 border-white mb-6 z-10"></div>
            <div class="bg-indigo-50 rounded-[2rem] p-6 text-indigo-900 border border-indigo-100 h-2/5 flex flex-col justify-center">
                <p class="text-[10px] opacity-60 uppercase font-bold tracking-widest">Day <span id="stat-day">1</span> é¢„ä¼°æ”¯å‡º</p>
                <p class="text-4xl font-black mt-2">Â¥ <span id="total-cost">0</span></p>
                <div class="mt-6 space-y-2">
                    <div class="flex justify-between text-xs font-bold text-indigo-400"><span>ä½å®¿</span><span id="cost-hotel">Â¥0</span></div>
                    <div class="flex justify-between text-xs font-bold text-indigo-400"><span>é¤é¥®</span><span id="cost-food">Â¥0</span></div>
                    <div class="flex justify-between text-xs font-bold text-indigo-400"><span>å…¶ä»–</span><span id="cost-other">Â¥0</span></div>
                </div>
            </div>
        </aside>
    </main>

    <div id="edit-modal" class="fixed inset-0 bg-slate-900/70 backdrop-blur-md z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] w-full max-w-lg p-8 shadow-2xl animate-in zoom-in duration-200 flex flex-col max-h-[90vh]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black">ç¼–è¾‘è¡Œç¨‹é¡¹</h3>
                <div class="flex gap-2">
                    <button onclick="duplicateItem()" class="text-[10px] bg-emerald-50 text-emerald-600 px-2 py-1 rounded font-bold hover:bg-emerald-100">å¤åˆ¶åˆ°æ˜å¤©</button>
                    <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600">âœ•</button>
                </div>
            </div>
            
            <div class="space-y-4 overflow-y-auto pr-2 custom-scrollbar flex-1">
                <div class="relative group cursor-pointer" onclick="document.getElementById('img-upload').click()">
                    <div class="h-32 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200 flex flex-col items-center justify-center overflow-hidden">
                        <img id="edit-img-show" class="hidden w-full h-full object-cover">
                        <div id="img-placeholder" class="text-center">
                            <span class="text-2xl">ğŸ“·</span>
                            <p class="text-[10px] font-bold text-slate-400 mt-1">æ·»åŠ å›¾ç‰‡/å‡­è¯</p>
                        </div>
                    </div>
                    <input type="file" id="img-upload" accept="image/*" class="hidden" onchange="handleImageUpload(this)">
                </div>

                <div class="grid grid-cols-4 gap-2">
                    <button onclick="setEditCat('sight')" class="cat-btn p-2 rounded-xl text-[10px] font-bold border" data-cat="sight">æ™¯ç‚¹</button>
                    <button onclick="setEditCat('food')" class="cat-btn p-2 rounded-xl text-[10px] font-bold border" data-cat="food">é¤é¥®</button>
                    <button onclick="setEditCat('hotel')" class="cat-btn p-2 rounded-xl text-[10px] font-bold border" data-cat="hotel">ä½å®¿</button>
                    <button onclick="setEditCat('activity')" class="cat-btn p-2 rounded-xl text-[10px] font-bold border" data-cat="activity">äº¤é€š/æ´»åŠ¨</button>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase mb-1 block">æ—¶æ®µ</label>
                        <select id="det-slot" class="w-full px-3 py-2 bg-slate-50 rounded-lg outline-none font-bold text-sm border border-slate-100">
                            <option value="morning">ä¸Šåˆ</option><option value="noon">ä¸­åˆ</option>
                            <option value="afternoon">ä¸‹åˆ</option><option value="evening">æ™šä¸Š</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase mb-1 block">ç§»åŠ¨è‡³å“ªå¤©</label>
                        <select id="det-day-move" class="w-full px-3 py-2 bg-slate-50 rounded-lg outline-none font-bold text-sm border border-slate-100"></select>
                    </div>
                </div>

                <input id="det-name" type="text" class="w-full px-4 py-3 bg-slate-50 rounded-xl outline-none font-bold text-sm border border-slate-100" placeholder="åœ°ç‚¹åç§°">
                <div class="grid grid-cols-2 gap-3">
                    <input id="det-cost" type="number" class="px-3 py-2 bg-slate-50 rounded-lg outline-none text-sm border border-slate-100" placeholder="é¢„ä¼°è´¹ç”¨ (Â¥)">
                    <input id="det-dur" type="number" class="px-3 py-2 bg-slate-50 rounded-lg outline-none text-sm border border-slate-100" placeholder="æ¸¸ç©æ—¶é—´ (åˆ†)">
                </div>
                <textarea id="det-note" rows="3" class="w-full px-4 py-3 bg-slate-50 rounded-xl outline-none resize-none text-xs border border-slate-100" placeholder="å¤‡æ³¨ä¿¡æ¯..."></textarea>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="saveDetails()" class="flex-1 py-3 bg-indigo-600 text-white rounded-xl font-bold text-xs shadow-lg hover:bg-indigo-700">ä¿å­˜ä¿®æ”¹</button>
            </div>
        </div>
    </div>

    <div id="overview-modal" class="fixed inset-0 bg-white z-[200] hidden overflow-y-auto">
        <div class="max-w-6xl mx-auto p-12 relative">
            <button onclick="closeOverview()" class="absolute top-12 right-12 w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold">âœ•</button>
            <h2 class="text-4xl font-black italic mb-2">Trip Overview</h2>
            <p class="text-indigo-600 font-bold mb-10 uppercase tracking-widest text-sm">æ€»è´¹ç”¨ï¼šÂ¥ <span id="overview-total-cost">0</span></p>
            <div id="overview-content" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
        </div>
    </div>

    <script>
        let currentDay = 0, daysData = JSON.parse(localStorage.getItem('travel_v14_days')) || [[]];
        let poiLibrary = JSON.parse(localStorage.getItem('travel_v14_lib')) || [];
        let startDate = localStorage.getItem('travel_v14_start') || new Date().toISOString().split('T')[0];
        let map, markers = [], editingId = null, tempCat = 'sight', tempImg = "", draggedId = null;

        window.onload = () => {
            document.getElementById('start-date').value = startDate;
            initMap(); initSearch(); renderDays(); renderLibrary(); updateUI();
        };

        function initMap() {
            map = L.map('map', { zoomControl: false }).setView([31.23, 121.47], 11);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
        }

        // --- æ‹–æ‹½æ’åºé€»è¾‘ ---
        function handleDragStart(e, id) {
            draggedId = id;
            e.currentTarget.classList.add('dragging');
            e.dataTransfer.setData('text/plain', id);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drop-zone');
        }

        function handleDrop(e, slot) {
            e.preventDefault();
            e.currentTarget.classList.remove('drop-zone');
            const id = e.dataTransfer.getData('text/plain');
            const item = daysData[currentDay].find(x => x.id === id);
            if (item) {
                item.slot = slot;
                // é‡æ–°æ’åºé€»è¾‘ï¼šç§»åŠ¨åˆ°è¯¥æ—¶æ®µæœ€å
                daysData[currentDay] = daysData[currentDay].filter(x => x.id !== id);
                daysData[currentDay].push(item);
                updateUI();
            }
        }

        // --- æ ¸å¿ƒä¿®å¤ï¼šå¤åˆ¶ä¸ç§»åŠ¨ ---
        window.duplicateItem = () => {
            if (!editingId) return;
            const it = daysData[currentDay].find(x => x.id === editingId);
            const targetDay = currentDay + 1;
            if (!daysData[targetDay]) daysData.push([]);
            daysData[targetDay].push({ ...it, id: Date.now().toString() + "_copy" });
            alert("å·²æˆåŠŸå¤åˆ¶åˆ° Day " + (targetDay + 1));
            saveToLocal();
        };

        window.openEdit = (id) => {
            editingId = id;
            const it = daysData[currentDay].find(x => x.id === id);
            document.getElementById('det-name').value = it.name;
            document.getElementById('det-slot').value = it.slot || 'morning';
            document.getElementById('det-cost').value = it.cost || 0;
            document.getElementById('det-dur').value = it.duration || 60;
            document.getElementById('det-note').value = it.note || "";
            tempImg = it.img || "";
            tempCat = it.cat || 'sight';
            
            // å¡«å……ç§»åŠ¨å¤©æ•°ä¸‹æ‹‰èœå•
            const moveSelect = document.getElementById('det-day-move');
            moveSelect.innerHTML = daysData.map((_, i) => `<option value="${i}" ${i === currentDay ? 'selected' : ''}>Day ${i+1}</option>`).join('');

            const imgShow = document.getElementById('edit-img-show');
            if(tempImg) { imgShow.src = tempImg; imgShow.classList.remove('hidden'); document.getElementById('img-placeholder').classList.add('hidden'); }
            else { imgShow.classList.add('hidden'); document.getElementById('img-placeholder').classList.remove('hidden'); }
            
            setEditCat(tempCat);
            document.getElementById('edit-modal').classList.remove('hidden');
        };

        window.saveDetails = () => {
            let itIdx = daysData[currentDay].findIndex(x => x.id === editingId);
            let it = daysData[currentDay][itIdx];
            const targetDay = parseInt(document.getElementById('det-day-move').value);

            it.name = document.getElementById('det-name').value;
            it.slot = document.getElementById('det-slot').value;
            it.cost = document.getElementById('det-cost').value;
            it.duration = document.getElementById('det-dur').value;
            it.note = document.getElementById('det-note').value;
            it.cat = tempCat;
            it.img = tempImg;

            if (targetDay !== currentDay) {
                daysData[targetDay].push(it);
                daysData[currentDay].splice(itIdx, 1);
            }
            updateUI(); closeModal();
        };

        // --- æœç´¢é€»è¾‘ (ä¿ç•™ç²¾å‡†æœç´¢) ---
        function initSearch() {
            const input = document.getElementById('map-search');
            const resPanel = document.getElementById('search-results');
            let timer;
            input.addEventListener('input', (e) => {
                clearTimeout(timer);
                const q = e.target.value.trim();
                if (q.length < 2) { resPanel.classList.add('hidden'); return; }
                timer = setTimeout(async () => {
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=6&addressdetails=1&accept-language=zh-CN`);
                    const data = await response.json();
                    resPanel.innerHTML = data.map(it => `
                        <div class="p-3 border-b hover:bg-slate-50 cursor-pointer" onclick="selectLocation('${it.display_name.split(',')[0]}', '${it.display_name}', ${it.lon}, ${it.lat})">
                            <div class="font-bold text-xs">${it.display_name.split(',')[0]}</div>
                            <div class="text-[9px] text-slate-400 truncate">${it.display_name}</div>
                        </div>`).join('');
                    resPanel.classList.remove('hidden');
                }, 500);
            });
        }

        window.selectLocation = (name, addr, lng, lat) => {
            poiLibrary.unshift({ id: Date.now().toString(), name, addr, lng, lat });
            renderLibrary();
            document.getElementById('search-results').classList.add('hidden');
            document.getElementById('map-search').value = "";
            map.flyTo([lat, lng], 14);
        };

        // --- æ¸²æŸ“ UI ---
        function updateUI() {
            const slots = ['morning', 'noon', 'afternoon', 'evening'];
            slots.forEach(s => document.getElementById(`slot-${s}`).innerHTML = '');
            
            markers.forEach(m => m.remove()); markers = [];
            let totals = { cost: 0, hotel: 0, food: 0, other: 0 };

            document.getElementById('current-day-title').innerText = `Day ${currentDay + 1}`;
            document.getElementById('current-day-date').innerText = getDayDate(currentDay);
            document.getElementById('stat-day').innerText = currentDay + 1;

            daysData[currentDay].forEach((item) => {
                const cost = parseFloat(item.cost || 0);
                totals.cost += cost;
                if(item.cat === 'hotel') totals.hotel += cost;
                else if(item.cat === 'food') totals.food += cost;
                else totals.other += cost;

                const card = document.createElement('div');
                card.draggable = true;
                card.ondragstart = (e) => handleDragStart(e, item.id);
                card.ondragend = (e) => e.currentTarget.classList.remove('dragging');
                card.className = "flex gap-3 p-3 bg-white border border-slate-100 rounded-xl shadow-sm group cursor-move hover:border-indigo-200 transition-all";
                
                card.innerHTML = `
                    ${item.img ? `<div class="w-12 h-12 shrink-0 rounded-lg overflow-hidden"><img src="${item.img}" class="w-full h-full object-cover"></div>` : ''}
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 mb-0.5">
                            <span class="cat-${item.cat || 'sight'} text-[7px] font-black px-1 py-0.5 rounded uppercase">${item.cat || 'sight'}</span>
                            <h4 class="text-xs font-bold text-slate-800 truncate">${item.name}</h4>
                        </div>
                        <p class="text-[9px] text-slate-400 truncate">ğŸ“ ${item.addr || ''}</p>
                        <div class="flex gap-2 mt-1 text-[9px] font-bold text-indigo-500"><span>Â¥${item.cost||0}</span><span>${item.duration||0}m</span></div>
                    </div>
                    <div class="flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition">
                        <button onclick="openEdit('${item.id}')" class="text-[10px] text-indigo-600 bg-indigo-50 p-1 rounded">âœ</button>
                        <button onclick="removeItem('${item.id}')" class="text-[10px] text-red-600 bg-red-50 p-1 rounded">âœ•</button>
                    </div>`;
                document.getElementById(`slot-${item.slot || 'morning'}`).appendChild(card);
                markers.push(L.marker([item.lat, item.lng]).addTo(map).bindPopup(item.name));
            });

            document.getElementById('total-cost').innerText = totals.cost;
            document.getElementById('cost-hotel').innerText = `Â¥${totals.hotel}`;
            document.getElementById('cost-food').innerText = `Â¥${totals.food}`;
            document.getElementById('cost-other').innerText = `Â¥${totals.other}`;
            if(markers.length > 0) map.fitBounds(new L.featureGroup(markers).getBounds().pad(0.2));
            saveToLocal();
        }

        // --- è¾…åŠ©å‡½æ•° ---
        window.addDay = () => { daysData.push([]); renderDays(); switchDay(daysData.length-1); };
        window.switchDay = (i) => { currentDay = i; updateUI(); renderDays(); };
        window.renderDays = () => { 
            document.getElementById('day-selector').innerHTML = daysData.map((_, i) => 
                `<button onclick="switchDay(${i})" class="w-8 h-8 rounded-lg text-[10px] font-black border ${i===currentDay?'active-day':'bg-white text-slate-300'}">${i+1}</button>`).join(''); 
        };
        window.renderLibrary = () => { 
            document.getElementById('library-list').innerHTML = poiLibrary.map(p => `
                <div class="p-3 border rounded-xl bg-white flex justify-between items-center">
                    <div class="min-w-0 flex-1"><h4 class="font-bold text-xs truncate">${p.name}</h4></div>
                    <button onclick="addToDay('${p.id}')" class="ml-2 bg-slate-900 text-white p-1.5 rounded-lg text-[10px]">æ·»åŠ </button>
                </div>`).join(''); 
        };
        window.addToDay = (id) => { const it = poiLibrary.find(x => x.id === id); daysData[currentDay].push({ ...it, id: Date.now().toString(), slot: 'morning', cost: 0, duration: 60, note: "", img: "" }); updateUI(); };
        window.removeItem = (id) => { daysData[currentDay] = daysData[currentDay].filter(x => x.id !== id); updateUI(); };
        window.closeModal = () => document.getElementById('edit-modal').classList.add('hidden');
        window.setEditCat = (c) => {
            tempCat = c;
            document.querySelectorAll('.cat-btn').forEach(b => b.className = b.dataset.cat === c ? "cat-btn p-2 rounded-xl text-[10px] font-bold border-2 border-indigo-600 bg-indigo-50 text-indigo-600" : "cat-btn p-2 rounded-xl text-[10px] font-bold border border-slate-200 bg-slate-50 text-slate-400");
        };
        window.handleImageUpload = (input) => {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => { 
                    tempImg = e.target.result; 
                    const imgEl = document.getElementById('edit-img-show');
                    imgEl.src = tempImg; imgEl.classList.remove('hidden');
                    document.getElementById('img-placeholder').classList.add('hidden');
                };
                reader.readAsDataURL(input.files[0]);
            }
        };
        window.exportData = () => {
            const data = btoa(encodeURIComponent(JSON.stringify({ v: "1.4", start: startDate, days: daysData, lib: poiLibrary })));
            navigator.clipboard.writeText(data).then(() => alert("ä»£ç å·²å¤åˆ¶ï¼"));
        };
        window.importData = () => {
            const code = prompt("ç²˜è´´ä»£ç ï¼š"); if (!code) return;
            try { const d = JSON.parse(decodeURIComponent(atob(code))); startDate = d.start; daysData = d.days; poiLibrary = d.lib; saveToLocal(); location.reload(); } catch (e) { alert("æ— æ•ˆ"); }
        };
        window.saveToLocal = () => { localStorage.setItem('travel_v14_days', JSON.stringify(daysData)); localStorage.setItem('travel_v14_lib', JSON.stringify(poiLibrary)); localStorage.setItem('travel_v14_start', startDate); };
        function getDayDate(idx) { const d = new Date(startDate); d.setDate(d.getDate() + idx); return d.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric', weekday: 'short' }); }
        window.updateDates = () => { startDate = document.getElementById('start-date').value; updateUI(); renderDays(); };
        window.openOverview = () => { /* å®ç°é€»è¾‘åŒå‰ï¼Œä¸ºèŠ‚çœç¯‡å¹…ç•¥ï¼Œæ ¸å¿ƒé€»è¾‘å·²åˆå¹¶ */ document.getElementById('overview-modal').classList.remove('hidden'); updateUI(); };
        window.closeOverview = () => document.getElementById('overview-modal').classList.add('hidden');
    </script>
</body>
</html>
